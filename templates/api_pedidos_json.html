<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Pedidos - JSON Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #667eea;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 1.5em;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Segoe UI', sans-serif;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #4a4a4a;
        }
        
        .btn-secondary:hover {
            background: #5a5a5a;
        }
        
        .info-bar {
            background: #2d2d2d;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #404040;
        }
        
        .endpoint-url {
            color: #4ec9b0;
            font-size: 1.1em;
        }
        
        .status-badge {
            padding: 5px 15px;
            background: #10b981;
            color: white;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .json-viewer {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            overflow-x: auto;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .json-viewer::-webkit-scrollbar {
            width: 10px;
        }
        
        .json-viewer::-webkit-scrollbar-track {
            background: #2d2d2d;
        }
        
        .json-viewer::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 5px;
        }
        
        pre {
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .json-key {
            color: #9cdcfe;
        }
        
        .json-string {
            color: #ce9178;
        }
        
        .json-number {
            color: #b5cea8;
        }
        
        .json-boolean {
            color: #569cd6;
        }
        
        .json-null {
            color: #569cd6;
        }
        
        .stats {
            background: #2d2d2d;
            padding: 15px 20px;
            display: flex;
            gap: 30px;
            border-bottom: 1px solid #404040;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-label {
            color: #999;
        }
        
        .stat-value {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .tabs {
            background: #2d2d2d;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #404040;
        }
        
        .tab {
            padding: 8px 20px;
            background: transparent;
            color: #999;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #1e1e1e;
            color: #667eea;
        }
        
        .tab:hover {
            color: #d4d4d4;
        }
        
        .view-options {
            background: #2d2d2d;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .filter-input {
            padding: 8px 15px;
            background: #1e1e1e;
            border: 1px solid #404040;
            border-radius: 5px;
            color: #d4d4d4;
            width: 300px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîå API Pedidos - JSON Viewer</h1>
            <div class="header-buttons">
                <a href="/pedidos/" class="btn">üìã Vista Visual</a>
                <a href="/" class="btn btn-secondary">‚Üê Volver</a>
            </div>
        </div>
        
        <div class="info-bar">
            <div class="endpoint-url">GET /api/pedidos/</div>
            <div class="status-badge">‚úì 200 OK</div>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">Total:</span>
                <span class="stat-value" id="totalItems">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Tiempo:</span>
                <span class="stat-value" id="responseTime">-</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Tama√±o:</span>
                <span class="stat-value" id="dataSize">-</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="cambiarVista('pretty')">‚ú® Pretty</button>
            <button class="tab" onclick="cambiarVista('raw')">üìÑ Raw</button>
            <button class="tab" onclick="cambiarVista('tree')">üå≥ Tree</button>
        </div>
        
        <div class="view-options">
            <input type="text" class="filter-input" id="filterInput" placeholder="Buscar en JSON...">
            <div>
                <button class="btn" onclick="copiarJSON()">üìã Copiar JSON</button>
                <button class="btn btn-secondary" onclick="descargarJSON()">üíæ Descargar</button>
            </div>
        </div>
        
        <div class="json-viewer" id="jsonViewer">
            <div class="loading">Cargando datos... ‚è≥</div>
        </div>
    </div>
    
    <script>
        let jsonData = null;
        let startTime = null;
        
        async function cargarDatos() {
            startTime = performance.now();
            
            try {
                const response = await fetch('/api/pedidos/?format=json');
                
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                jsonData = await response.json();
                
                // Actualizar estad√≠sticas
                document.getElementById('totalItems').textContent = jsonData.pedidos.length;
                document.getElementById('responseTime').textContent = responseTime + ' ms';
                
                const dataStr = JSON.stringify(jsonData);
                const bytes = new Blob([dataStr]).size;
                const size = bytes < 1024 ? bytes + ' B' : Math.round(bytes / 1024) + ' KB';
                document.getElementById('dataSize').textContent = size;
                
                // Mostrar JSON
                mostrarJSON('pretty');
                
            } catch (error) {
                document.getElementById('jsonViewer').innerHTML = 
                    '<div style="color: #ef4444; padding: 20px;">‚ùå Error al cargar datos: ' + error.message + '</div>';
            }
        }
        
        function mostrarJSON(vista) {
            const viewer = document.getElementById('jsonViewer');
            
            if (!jsonData) return;
            
            switch(vista) {
                case 'pretty':
                    viewer.innerHTML = '<pre>' + syntaxHighlight(JSON.stringify(jsonData, null, 2)) + '</pre>';
                    break;
                case 'raw':
                    viewer.innerHTML = '<pre>' + JSON.stringify(jsonData) + '</pre>';
                    break;
                case 'tree':
                    viewer.innerHTML = '<pre>' + createTree(jsonData) + '</pre>';
                    break;
            }
        }
        
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        function createTree(obj, level = 0) {
            let html = '';
            const indent = '  '.repeat(level);
            
            if (Array.isArray(obj)) {
                html += indent + 'üìã Array (' + obj.length + ' items)\n';
                obj.forEach((item, index) => {
                    html += indent + '  [' + index + ']\n';
                    html += createTree(item, level + 2);
                });
            } else if (typeof obj === 'object' && obj !== null) {
                for (let key in obj) {
                    const value = obj[key];
                    if (typeof value === 'object') {
                        html += indent + 'üìÅ ' + key + '\n';
                        html += createTree(value, level + 1);
                    } else {
                        html += indent + '  ' + key + ': ' + value + '\n';
                    }
                }
            }
            
            return html;
        }
        
        function cambiarVista(vista) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            mostrarJSON(vista);
        }
        
        function copiarJSON() {
            const jsonStr = JSON.stringify(jsonData, null, 2);
            navigator.clipboard.writeText(jsonStr).then(() => {
                event.target.textContent = '‚úì Copiado!';
                setTimeout(() => {
                    event.target.textContent = 'üìã Copiar JSON';
                }, 2000);
            });
        }
        
        function descargarJSON() {
            const jsonStr = JSON.stringify(jsonData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pedidos_' + new Date().getTime() + '.json';
            a.click();
        }
        
        // Filtro de b√∫squeda
        document.getElementById('filterInput').addEventListener('input', function(e) {
            const termino = e.target.value.toLowerCase();
            if (!termino) {
                mostrarJSON('pretty');
                return;
            }
            
            const filtrado = jsonData.pedidos.filter(p => 
                JSON.stringify(p).toLowerCase().includes(termino)
            );
            
            const viewer = document.getElementById('jsonViewer');
            viewer.innerHTML = '<pre>' + syntaxHighlight(JSON.stringify({pedidos: filtrado}, null, 2)) + '</pre>';
        });
        
        // Cargar datos al iniciar
        cargarDatos();
        
        // Auto-refresh cada 30 segundos
        setInterval(cargarDatos, 30000);
    </script>
</body>
</html>